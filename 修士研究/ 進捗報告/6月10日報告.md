# 背景情報をなくしてImgsimをやってみた

## 前回までの進捗
### ユニフォームの色が似ている人同士でも距離を計算してみる
![to_github3](https://github.com/e204208iy/TIL/assets/72591871/be28070a-1247-4f98-81ac-2a4429553a1d)
※ 一段目が同じ人で二段目がGallery

#### 一段目の一番左の人をQueryとする。
| 同じ人 | 距離 |　|　違う人 | 距離 |
| -- | -- | -- | -- | -- |
| 　　1 | 13.560963 | | 1 | 15.342218 |
| 　　2 | 12.848311 | | 2 | 14.851833 |
| 　　3 | 19.586132 | | 3 | 23.056866 |
| 　　4 | 14.381772 | | 4 | 18.973288 |
| 　　5 | 17.720009 | | 5 | 15.511065 |
| 　　 |  | | 6 | 28.096533 |

## 背景処理後
![名称未設定 x](https://github.com/e204208iy/TIL/assets/72591871/7015e8a5-3805-424d-b893-572f7f480ea6)

#### 一段目の一番左の人をQueryとする。
| 同じ人 | 距離 |　|　違う人 | 距離 |
| -- | -- | -- | -- | -- |
| 　　1 | 12.16424 | | 1 | 15.483642 |
| 　　2 | 12.869821 | | 2 | 14.901065 |
| 　　3 | 19.209679 | | 3 | 21.88046 |
| 　　4 | 14.4379 | | 4 | 19.18708 |
| 　　5 | 19.31718 | | 5 | 15.749639 |
| 　　 |  | | 6 | 28.12568 |

### 比較
| 同じ人 | 距離 |　|　違う人 | 距離 |　背景処理後→　| 同じ人 | 距離 |　|　違う人 | 距離 |
| -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- |
| 　　1 | 12.16424 | | 1 | 15.483642 | | 　　1 | 13.560963 | | 1 | 15.342218 |
| 　　2 | 12.869821 | | 2 | 14.901065 | | 　　2 | 12.848311 | | 2 | 14.851833 |
| 　　3 | 19.209679 | | 3 | 21.88046 | | 　　3 | 19.586132 | | 3 | 23.056866 |
| 　　4 | 14.4379 | | 4 | 19.18708 | | 　　4 | 14.381772 | | 4 | 18.973288 |
| 　　5 | 19.31718 | | 5 | 15.749639 | | 　　5 | 17.720009 | | 5 | 15.511065 |
| 　　 |  | | 6 | 28.12568 | | 　　 |  | | 6 | 28.096533 |


## 今回使用したコード
```python
import cv2
import numpy as np
from ultralytics import YOLO

m = YOLO("yolov8m-seg.pt")  
res = m.predict("../images/same/00449_02_19.jpeg")

img = np.copy(res[0].orig_img)
label = res[0][0].names[res[0][0].boxes.cls.tolist().pop()]

b_mask = np.zeros(img.shape[:2], np.uint8)

contour = res[0][0].masks.xy.pop().astype(np.int32).reshape(-1, 1, 2)
_ = cv2.drawContours(b_mask, [contour], -1, (255, 255, 255), cv2.FILLED)

isolated = np.dstack([img, b_mask])
x1, y1, x2, y2 = res[0][0].boxes.xyxy.cpu().numpy().squeeze().astype(np.int32)
iso_crop = isolated[y1:y2, x1:x2]

cv2.imwrite('same/isolated_objectz_same5.png', iso_crop)
```
